(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Sifter=b()}}}(this,function(){var f=function(h,i){this.items=h;this.settings=i||{diacritics:true}};f.prototype.tokenize=function(l){l=b(String(l||"").toLowerCase());if(!l||!l.length){return[]}var h,p,k,j;var m=[];var o=l.split(/ +/);for(h=0,p=o.length;h<p;h++){k=c(o[h]);if(this.settings.diacritics){for(j in a){if(a.hasOwnProperty(j)){k=k.replace(new RegExp(j,"g"),a[j])}}}m.push({string:o[h],regex:new RegExp(k,"i")})}return m};f.prototype.iterator=function(h,j){var i;if(d(h)){i=Array.prototype.forEach||function(m){for(var k=0,l=this.length;k<l;k++){m(this[k],k,this)}}}else{i=function(l){for(var k in this){if(this.hasOwnProperty(k)){l(this[k],k,this)}}}}i.apply(h,[j])};f.prototype.getScoreFunction=function(m,k){var j,i,o,n;j=this;m=j.prepareSearch(m,k);o=m.tokens;i=m.options.fields;n=o.length;var h=function(q,p){var r,s;if(!q){return 0}q=String(q||"");s=q.search(p.regex);if(s===-1){return 0}r=p.string.length/q.length;if(s===0){r+=0.5}return r};var l=(function(){var p=i.length;if(!p){return function(){return 0}}if(p===1){return function(q,r){return h(r[i[0]],q)}}return function(r,t){for(var q=0,s=0;q<p;q++){s+=h(t[i[q]],r)}return s/p}})();if(!n){return function(){return 0}}if(n===1){return function(p){return l(o[0],p)}}if(m.options.conjunction==="and"){return function(r){var s;for(var p=0,q=0;p<n;p++){s=l(o[p],r);if(s<=0){return 0}q+=s}return q/n}}else{return function(r){for(var p=0,q=0;p<n;p++){q+=l(o[p],r)}return q/n}}};f.prototype.getSortFunction=function(u,v){var p,h,t,r,q,k,s,m,j,l,o;t=this;u=t.prepareSearch(u,v);o=(!u.query&&v.sort_empty)||v.sort;j=function(n,i){if(n==="$score"){return i.score}return t.items[i.id][n]};q=[];if(o){for(p=0,h=o.length;p<h;p++){if(u.query||o[p].field!=="$score"){q.push(o[p])}}}if(u.query){l=true;for(p=0,h=q.length;p<h;p++){if(q[p].field==="$score"){l=false;break}}if(l){q.unshift({field:"$score",direction:"desc"})}}else{for(p=0,h=q.length;p<h;p++){if(q[p].field==="$score"){q.splice(p,1);break}}}m=[];for(p=0,h=q.length;p<h;p++){m.push(q[p].direction==="desc"?-1:1)}k=q.length;if(!k){return null}else{if(k===1){r=q[0].field;s=m[0];return function(n,i){return s*e(j(r,n),j(r,i))}}else{return function(y,w){var A,n,x,z,B;for(A=0;A<k;A++){B=q[A].field;n=m[A]*e(j(B,y),j(B,w));if(n){return n}}return 0}}}};f.prototype.prepareSearch=function(k,h){if(typeof k==="object"){return k}h=g({},h);var j=h.fields;var l=h.sort;var i=h.sort_empty;if(j&&!d(j)){h.fields=[j]}if(l&&!d(l)){h.sort=[l]}if(i&&!d(i)){h.sort_empty=[i]}return{options:h,query:String(k||"").toLowerCase(),tokens:this.tokenize(k),total:0,items:[]}};f.prototype.search=function(k,p){var n=this,m,i,o,j;var h;var l;o=this.prepareSearch(k,p);p=o.options;k=o.query;l=p.score||n.getScoreFunction(o);if(k.length){n.iterator(n.items,function(q,r){i=l(q);if(p.filter===false||i>0){o.items.push({score:i,id:r})}})}else{n.iterator(n.items,function(q,r){o.items.push({score:1,id:r})})}h=n.getSortFunction(o,p);if(h){o.items.sort(h)}o.total=o.items.length;if(typeof p.limit==="number"){o.items=o.items.slice(0,p.limit)}return o};var e=function(i,h){if(typeof i==="number"&&typeof h==="number"){return i>h?1:(i<h?-1:0)}i=String(i||"").toLowerCase();h=String(h||"").toLowerCase();if(i>h){return 1}if(h>i){return -1}return 0};var g=function(j,h){var o,p,l,m;for(o=1,p=arguments.length;o<p;o++){m=arguments[o];if(!m){continue}for(l in m){if(m.hasOwnProperty(l)){j[l]=m[l]}}}return j};var b=function(h){return(h+"").replace(/^\s+|\s+$|/g,"")};var c=function(h){return(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var d=Array.isArray||($&&$.isArray)||function(h){return Object.prototype.toString.call(h)==="[object Array]"};var a={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇçćĆčČ]",d:"[dđĐ]",e:"[eÈÉÊËèéêë]",i:"[iÌÍÎÏìíîï]",n:"[nÑñ]",o:"[oÒÓÔÕÕÖØòóôõöø]",s:"[sŠš]",u:"[uÙÚÛÜùúûü]",y:"[yŸÿý]",z:"[zŽž]"};return f}));(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.MicroPlugin=b()}}}(this,function(){var a={};a.mixin=function(c){c.plugins={};c.prototype.initializePlugins=function(e){var h,j,g;var f=this;var d=[];f.plugins={names:[],settings:{},requested:{},loaded:{}};if(b.isArray(e)){for(h=0,j=e.length;h<j;h++){if(typeof e[h]==="string"){d.push(e[h])}else{f.plugins.settings[e[h].name]=e[h].options;d.push(e[h].name)}}}else{if(e){for(g in e){if(e.hasOwnProperty(g)){f.plugins.settings[g]=e[g];d.push(g)}}}}while(d.length){f.require(d.shift())}};c.prototype.loadPlugin=function(f){var e=this;var d=e.plugins;var g=c.plugins[f];if(!c.plugins.hasOwnProperty(f)){throw new Error('Unable to find "'+f+'" plugin')}d.requested[f]=true;d.loaded[f]=g.fn.apply(e,[e.plugins.settings[f]||{}]);d.names.push(f)};c.prototype.require=function(f){var e=this;var d=e.plugins;if(!e.plugins.loaded.hasOwnProperty(f)){if(d.requested[f]){throw new Error('Plugin has circular dependency ("'+f+'")')}e.loadPlugin(f)}return d.loaded[f]};c.define=function(d,e){c.plugins[d]={name:d,fn:e}}};var b={isArray:Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"}};return a}));(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","sifter","microplugin"],b)}else{a.Selectize=b(a.jQuery,a.Sifter,a.MicroPlugin)}}(this,function(u,l,h){var H=function(K,N){if(typeof N==="string"&&!N.length){return}var M=(typeof N==="string")?new RegExp(N,"i"):N;var L=function(Q){var W=0;if(Q.nodeType===3){var V=Q.data.search(M);if(V>=0&&Q.data.length>0){var U=Q.data.match(M);var T=document.createElement("span");T.className="highlight";var R=Q.splitText(V);var O=R.splitText(U[0].length);var P=R.cloneNode(true);T.appendChild(P);R.parentNode.replaceChild(T,R);W=1}}else{if(Q.nodeType===1&&Q.childNodes&&!/(script|style)/i.test(Q.tagName)){for(var S=0;S<Q.childNodes.length;++S){S+=L(Q.childNodes[S])}}}return W};return K.each(function(){L(this)})};var B=function(){};B.prototype={on:function(L,K){this._events=this._events||{};this._events[L]=this._events[L]||[];this._events[L].push(K)},off:function(L,K){var M=arguments.length;if(M===0){return delete this._events}if(M===1){return delete this._events[L]}this._events=this._events||{};if(L in this._events===false){return}this._events[L].splice(this._events[L].indexOf(K),1)},trigger:function(L){this._events=this._events||{};if(L in this._events===false){return}for(var K=0;K<this._events[L].length;K++){this._events[L][K].apply(this,Array.prototype.slice.call(arguments,1))}}};B.mixin=function(K){var M=["on","off","trigger"];for(var L=0;L<M.length;L++){K.prototype[M[L]]=B.prototype[M[L]]}};var c=/Mac/.test(navigator.userAgent);var D=65;var I=188;var x=13;var v=27;var o=37;var C=38;var s=39;var t=40;var m=8;var p=46;var i=16;var E=c?91:17;var e=c?18:17;var A=9;var j=1;var g=2;var J=function(K){return typeof K!=="undefined"};var w=function(K){if(typeof K==="undefined"||K===null){return""}if(typeof K==="boolean"){return K?"1":"0"}return K+""};var z=function(K){return(K+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var r={};r.before=function(K,N,M){var L=K[N];K[N]=function(){M.apply(K,arguments);return L.apply(K,arguments)}};r.after=function(K,N,M){var L=K[N];K[N]=function(){var O=L.apply(K,arguments);M.apply(K,arguments);return O}};var a=function(L,N){if(!u.isArray(N)){return N}var K,O,M={};for(K=0,O=N.length;K<O;K++){if(N[K].hasOwnProperty(L)){M[N[K][L]]=N[K]}}return M};var q=function(K){var L=false;return function(){if(L){return}L=true;K.apply(this,arguments)}};var f=function(L,K){var M;return function(){var N=this;var O=arguments;window.clearTimeout(M);M=window.setTimeout(function(){L.apply(N,O)},K)}};var b=function(K,M,O){var N;var L=K.trigger;var P={};K.trigger=function(){var Q=arguments[0];if(M.indexOf(Q)!==-1){P[Q]=arguments}else{return L.apply(K,arguments)}};O.apply(K,[]);K.trigger=L;for(N in P){if(P.hasOwnProperty(N)){L.apply(K,P[N])}}};var y=function(N,M,K,L){N.on(M,K,function(O){var P=O.target;while(P&&P.parentNode!==N[0]){P=P.parentNode}O.currentTarget=P;return L.apply(this,[O])})};var k=function(M){var L={};if("selectionStart" in M){L.start=M.selectionStart;L.length=M.selectionEnd-L.start}else{if(document.selection){M.focus();var N=document.selection.createRange();var K=document.selection.createRange().text.length;N.moveStart("character",-M.value.length);L.start=N.text.length-K;L.length=K}}return L};var n=function(N,O,L){var K,P,M={};if(L){for(K=0,P=L.length;K<P;K++){M[L[K]]=N.css(L[K])}}else{M=N.css()}O.css(M)};var F=function(N,M){var L=u("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(N).appendTo("body");n(M,L,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var K=L.width();L.remove();return K};var G=function(L){var K=function(P){var T,U,Q,S,M;var N,O,R;P=P||window.event||{};if(P.metaKey||P.altKey){return}if(L.data("grow")===false){return}T=L.val();if(P.type&&P.type.toLowerCase()==="keydown"){U=P.keyCode;Q=((U>=97&&U<=122)||(U>=65&&U<=90)||(U>=48&&U<=57)||U===32);if(U===p||U===m){R=k(L[0]);if(R.length){T=T.substring(0,R.start)+T.substring(R.start+R.length)}else{if(U===m&&R.start){T=T.substring(0,R.start-1)+T.substring(R.start+1)}else{if(U===p&&typeof R.start!=="undefined"){T=T.substring(0,R.start)+T.substring(R.start+1)}}}}else{if(Q){N=P.shiftKey;O=String.fromCharCode(P.keyCode);if(N){O=O.toUpperCase()}else{O=O.toLowerCase()}T+=O}}}S=L.attr("placeholder")||"";if(!T.length&&S.length){T=S}M=F(T,L)+4;if(M!==L.width()){L.width(M);L.triggerHandler("resize")}};L.on("keydown keyup update blur",K);K()};var d=function(R,P){var O,N,Q,M,L,K=this;L=R[0];L.selectize=K;M=window.getComputedStyle?window.getComputedStyle(L,null).getPropertyValue("direction"):L.currentStyle&&L.currentStyle.direction;M=M||R.parents("[dir]:first").attr("dir")||"";u.extend(K,{settings:P,$input:R,tagType:L.tagName.toLowerCase()==="select"?j:g,rtl:/rtl/i.test(M),eventNS:".selectize"+(++d.count),highlightedValue:null,isOpen:false,isDisabled:false,isRequired:R.is(":required"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:f(K.onSearchChange,P.loadThrottle)});K.sifter=new l(this.options,{diacritics:P.diacritics});u.extend(K.options,a(P.valueField,P.options));delete K.settings.options;u.extend(K.optgroups,a(P.optgroupValueField,P.optgroups));delete K.settings.optgroups;K.settings.mode=K.settings.mode||(K.settings.maxItems===1?"single":"multi");if(typeof K.settings.hideSelected!=="boolean"){K.settings.hideSelected=K.settings.mode==="multi"}K.initializePlugins(K.settings.plugins);K.setupCallbacks();K.setupTemplates();K.setup()};B.mixin(d);h.mixin(d);u.extend(d.prototype,{setup:function(){var aa=this;var Q=aa.settings;var L=aa.eventNS;var M=u(window);var R=u(document);var U;var X;var Y;var V;var Z;var N;var K;var W;var O;var T;var P;var S;K=aa.settings.mode;T=aa.$input.attr("tabindex")||"";P=aa.$input.attr("class")||"";U=u("<div>").addClass(Q.wrapperClass).addClass(P).addClass(K);X=u("<div>").addClass(Q.inputClass).addClass("items").appendTo(U);Y=u('<input type="text" autocomplete="off">').appendTo(X).attr("tabindex",T);N=u(Q.dropdownParent||U);V=u("<div>").addClass(Q.dropdownClass).addClass(P).addClass(K).hide().appendTo(N);Z=u("<div>").addClass(Q.dropdownContentClass).appendTo(V);U.css({width:aa.$input[0].style.width});if(aa.plugins.names.length){S="plugin-"+aa.plugins.names.join(" plugin-");U.addClass(S);V.addClass(S)}if((Q.maxItems===null||Q.maxItems>1)&&aa.tagType===j){aa.$input.attr("multiple","multiple")}if(aa.settings.placeholder){Y.attr("placeholder",Q.placeholder)}aa.$wrapper=U;aa.$control=X;aa.$control_input=Y;aa.$dropdown=V;aa.$dropdown_content=Z;V.on("mouseenter","[data-selectable]",function(){return aa.onOptionHover.apply(aa,arguments)});V.on("mousedown","[data-selectable]",function(){return aa.onOptionSelect.apply(aa,arguments)});y(X,"mousedown","*:not(input)",function(){return aa.onItemSelect.apply(aa,arguments)});G(Y);X.on({mousedown:function(){return aa.onMouseDown.apply(aa,arguments)},click:function(){return aa.onClick.apply(aa,arguments)}});Y.on({mousedown:function(ab){ab.stopPropagation()},keydown:function(){return aa.onKeyDown.apply(aa,arguments)},keyup:function(){return aa.onKeyUp.apply(aa,arguments)},keypress:function(){return aa.onKeyPress.apply(aa,arguments)},resize:function(){aa.positionDropdown.apply(aa,[])},blur:function(){return aa.onBlur.apply(aa,arguments)},focus:function(){return aa.onFocus.apply(aa,arguments)}});R.on("keydown"+L,function(ab){aa.isCmdDown=ab[c?"metaKey":"ctrlKey"];aa.isCtrlDown=ab[c?"altKey":"ctrlKey"];aa.isShiftDown=ab.shiftKey});R.on("keyup"+L,function(ab){if(ab.keyCode===e){aa.isCtrlDown=false}if(ab.keyCode===i){aa.isShiftDown=false}if(ab.keyCode===E){aa.isCmdDown=false}});R.on("mousedown"+L,function(ab){if(aa.isFocused){if(ab.target===aa.$dropdown[0]||ab.target.parentNode===aa.$dropdown[0]){return false}if(!aa.$control.has(ab.target).length&&ab.target!==aa.$control[0]){aa.blur()}}});M.on(["scroll"+L,"resize"+L].join(" "),function(){if(aa.isOpen){aa.positionDropdown.apply(aa,arguments)}});M.on("mousemove"+L,function(){aa.ignoreHover=false});this.revertSettings={$children:aa.$input.children().detach(),tabindex:aa.$input.attr("tabindex")};aa.$input.attr("tabindex",-1).hide().after(aa.$wrapper);if(u.isArray(Q.items)){aa.setValue(Q.items);delete Q.items}if(aa.$input[0].validity){aa.$input.on("invalid"+L,function(ab){ab.preventDefault();aa.isInvalid=true;aa.refreshState()})}aa.updateOriginalInput();aa.refreshItems();aa.refreshState();aa.updatePlaceholder();aa.isSetup=true;if(aa.$input.is(":disabled")){aa.disable()}aa.on("change",this.onChange);aa.trigger("initialize");if(Q.preload){aa.onSearchChange("")}},setupTemplates:function(){var L=this;var K=L.settings.labelField;var M=L.settings.optgroupLabelField;var N={optgroup:function(O){return'<div class="optgroup">'+O.html+"</div>"},optgroup_header:function(P,O){return'<div class="optgroup-header">'+O(P[M])+"</div>"},option:function(P,O){return'<div class="option">'+O(P[K])+"</div>"},item:function(P,O){return'<div class="item">'+O(P[K])+"</div>"},option_create:function(P,O){return'<div class="create">Add <strong>'+O(P.input)+"</strong>&hellip;</div>"}};L.settings.render=u.extend({},N,L.settings.render)},setupCallbacks:function(){var K,L,M={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(K in M){if(M.hasOwnProperty(K)){L=this.settings[M[K]];if(L){this.on(K,L)}}}},onClick:function(L){var K=this;if(!K.isFocused){K.focus();L.preventDefault()}},onMouseDown:function(N){var L=this;var M=N.isDefaultPrevented();var K=u(N.target);if(L.isFocused){if(N.target!==L.$control_input[0]){if(L.settings.mode==="single"){L.isOpen?L.close():L.open()}else{if(!M){L.setActiveItem(null)}}return false}}else{if(!M){window.setTimeout(function(){L.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onKeyPress:function(L){if(this.isLocked){return L&&L.preventDefault()}var K=String.fromCharCode(L.keyCode||L.which);if(this.settings.create&&K===this.settings.delimiter){this.createItem();L.preventDefault();return false}},onKeyDown:function(O){var N=O.target===this.$control_input[0];var M=this;if(M.isLocked){if(O.keyCode!==A){O.preventDefault()}return}switch(O.keyCode){case D:if(M.isCmdDown){M.selectAll();return}break;case v:M.blur();return;case t:if(!M.isOpen&&M.hasOptions){M.open()}else{if(M.$activeOption){M.ignoreHover=true;var K=M.getAdjacentOption(M.$activeOption,1);if(K.length){M.setActiveOption(K,true,true)}}}O.preventDefault();return;case C:if(M.$activeOption){M.ignoreHover=true;var L=M.getAdjacentOption(M.$activeOption,-1);if(L.length){M.setActiveOption(L,true,true)}}O.preventDefault();return;case x:if(M.isOpen&&M.$activeOption){M.onOptionSelect({currentTarget:M.$activeOption})}O.preventDefault();return;case o:M.advanceSelection(-1,O);return;case s:M.advanceSelection(1,O);return;case A:if(M.settings.create&&u.trim(M.$control_input.val()).length){M.createItem();O.preventDefault()}return;case m:case p:M.deleteSelection(O);return}if(M.isFull()||M.isInputHidden){O.preventDefault();return}},onKeyUp:function(M){var K=this;if(K.isLocked){return M&&M.preventDefault()}var L=K.$control_input.val()||"";if(K.lastValue!==L){K.lastValue=L;K.onSearchChange(L);K.refreshOptions();K.trigger("type",L)}},onSearchChange:function(M){var K=this;var L=K.settings.load;if(!L){return}if(K.loadedSearches.hasOwnProperty(M)){return}K.loadedSearches[M]=true;K.load(function(N){L.apply(K,[M,N])})},onFocus:function(L){var K=this;K.isFocused=true;if(K.isDisabled){K.blur();L.preventDefault();return false}if(K.ignoreFocus){return}if(K.settings.preload==="focus"){K.onSearchChange("")}if(!K.$activeItems.length){K.showInput();K.setActiveItem(null);K.refreshOptions(!!K.settings.openOnFocus)}K.refreshState()},onBlur:function(L){var K=this;K.isFocused=false;if(K.ignoreFocus){return}K.close();K.setTextboxValue("");K.setActiveItem(null);K.setActiveOption(null);K.setCaret(K.items.length);K.refreshState()},onOptionHover:function(K){if(this.ignoreHover){return}this.setActiveOption(K.currentTarget,false)},onOptionSelect:function(O){var M,K,N,L=this;if(O.preventDefault){O.preventDefault();O.stopPropagation()}K=u(O.currentTarget);if(K.hasClass("create")){L.createItem()}else{M=K.attr("data-value");if(M){L.setTextboxValue("");L.addItem(M);if(!L.settings.hideSelected&&O.type&&/mouse/.test(O.type)){L.setActiveOption(L.getOption(M))}}}},onItemSelect:function(L){var K=this;if(K.isLocked){return}if(K.settings.mode==="multi"){L.preventDefault();K.setActiveItem(L.currentTarget,L)}},load:function(L){var K=this;var M=K.$wrapper.addClass("loading");K.loading++;L.apply(K,[function(N){K.loading=Math.max(K.loading-1,0);if(N&&N.length){K.addOption(N);K.refreshOptions(K.isFocused&&!K.isInputHidden)}if(!K.loading){M.removeClass("loading")}K.trigger("load",N)}])},setTextboxValue:function(K){this.$control_input.val(K).triggerHandler("update");this.lastValue=K},getValue:function(){if(this.tagType===j&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(K){b(this,["change"],function(){this.clear();var L=u.isArray(K)?K:[K];for(var M=0,N=L.length;M<N;M++){this.addItem(L[M])}})},setActiveItem:function(R,P){var U=this;var O;var N,S,K,M,T,L;var Q;if(U.settings.mode==="single"){return}R=u(R);if(!R.length){u(U.$activeItems).removeClass("active");U.$activeItems=[];if(U.isFocused){U.showInput()}return}O=P&&P.type.toLowerCase();if(O==="mousedown"&&U.isShiftDown&&U.$activeItems.length){Q=U.$control.children(".active:last");K=Array.prototype.indexOf.apply(U.$control[0].childNodes,[Q[0]]);M=Array.prototype.indexOf.apply(U.$control[0].childNodes,[R[0]]);if(K>M){L=K;K=M;M=L}for(N=K;N<=M;N++){T=U.$control[0].childNodes[N];if(U.$activeItems.indexOf(T)===-1){u(T).addClass("active");U.$activeItems.push(T)}}P.preventDefault()}else{if((O==="mousedown"&&U.isCtrlDown)||(O==="keydown"&&this.isShiftDown)){if(R.hasClass("active")){S=U.$activeItems.indexOf(R[0]);U.$activeItems.splice(S,1);R.removeClass("active")}else{U.$activeItems.push(R.addClass("active")[0])}}else{u(U.$activeItems).removeClass("active");U.$activeItems=[R.addClass("active")[0]]}}U.hideInput();if(!this.isFocused){U.focus()}},setActiveOption:function(K,Q,M){var L,R,P;var O,N;var S=this;if(S.$activeOption){S.$activeOption.removeClass("active")}S.$activeOption=null;K=u(K);if(!K.length){return}S.$activeOption=K.addClass("active");if(Q||!J(Q)){L=S.$dropdown_content.height();R=S.$activeOption.outerHeight(true);Q=S.$dropdown_content.scrollTop()||0;P=S.$activeOption.offset().top-S.$dropdown_content.offset().top+Q;O=P;N=P-L+R;if(P+R>L-Q){S.$dropdown_content.stop().animate({scrollTop:N},M?S.settings.scrollDuration:0)}else{if(P<Q){S.$dropdown_content.stop().animate({scrollTop:O},M?S.settings.scrollDuration:0)}}}},selectAll:function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active"));if(this.$activeItems.length){this.hideInput();this.close()}this.focus()},hideInput:function(){var K=this;K.setTextboxValue("");K.$control_input.css({opacity:0,position:"absolute",left:K.rtl?10000:-10000});K.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var K=this;if(K.isDisabled){return}K.ignoreFocus=true;K.$control_input[0].focus();window.setTimeout(function(){K.ignoreFocus=false;K.onFocus()},0)},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(K){return this.sifter.getScoreFunction(K,this.getSearchOptions())},getSearchOptions:function(){var L=this.settings;var K=L.sortField;if(typeof K==="string"){K={field:K}}return{fields:L.searchField,conjunction:L.searchConjunction,sort:K}},search:function(O){var N,P,K,S,M;var Q=this;var L=Q.settings;var R=this.getSearchOptions();if(L.score){M=Q.settings.score.apply(this,[O]);if(typeof M!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(O!==Q.lastQuery){Q.lastQuery=O;S=Q.sifter.search(O,u.extend(R,{score:M}));Q.currentResults=S}else{S=u.extend(true,{},Q.currentResults)}if(L.hideSelected){for(N=S.items.length-1;N>=0;N--){if(Q.items.indexOf(w(S.items[N].id))!==-1){S.items.splice(N,1)}}}return S},refreshOptions:function(U){var ab,aa,Z,X,ae,K,Q,ac,M,Y,O,ad,P;var N,T,V;if(typeof U==="undefined"){U=true}var S=this;var L=S.$control_input.val();var W=S.search(L);var R=S.$dropdown_content;var af=S.$activeOption&&w(S.$activeOption.attr("data-value"));X=W.items.length;if(typeof S.settings.maxOptions==="number"){X=Math.min(X,S.settings.maxOptions)}ae={};if(S.settings.optgroupOrder){K=S.settings.optgroupOrder;for(ab=0;ab<K.length;ab++){ae[K[ab]]=[]}}else{K=[]}for(ab=0;ab<X;ab++){Q=S.options[W.items[ab].id];ac=S.render("option",Q);M=Q[S.settings.optgroupField]||"";Y=u.isArray(M)?M:[M];for(aa=0,Z=Y&&Y.length;aa<Z;aa++){M=Y[aa];if(!S.optgroups.hasOwnProperty(M)){M=""}if(!ae.hasOwnProperty(M)){ae[M]=[];K.push(M)}ae[M].push(ac)}}O=[];for(ab=0,X=K.length;ab<X;ab++){M=K[ab];if(S.optgroups.hasOwnProperty(M)&&ae[M].length){ad=S.render("optgroup_header",S.optgroups[M])||"";ad+=ae[M].join("");O.push(S.render("optgroup",u.extend({},S.optgroups[M],{html:ad})))}else{O.push(ae[M].join(""))}}R.html(O.join(""));if(S.settings.highlight&&W.query.length&&W.tokens.length){for(ab=0,X=W.tokens.length;ab<X;ab++){H(R,W.tokens[ab].regex)}}if(!S.settings.hideSelected){for(ab=0,X=S.items.length;ab<X;ab++){S.getOption(S.items[ab]).addClass("selected")}}P=S.settings.create&&W.query.length;if(P){R.prepend(S.render("option_create",{input:L}));V=u(R[0].childNodes[0])}S.hasOptions=W.items.length>0||P;if(S.hasOptions){if(W.items.length>0){T=af&&S.getOption(af);if(T&&T.length){N=T}else{if(S.settings.mode==="single"&&S.items.length){N=S.getOption(S.items[0])}}if(!N||!N.length){if(V&&!S.settings.addPrecedence){N=S.getAdjacentOption(V,1)}else{N=R.find("[data-selectable]:first")}}}else{N=V}S.setActiveOption(N);if(U&&!S.isOpen){S.open()}}else{S.setActiveOption(null);if(U&&S.isOpen){S.close()}}},addOption:function(O){var M,P,L,N,K=this;if(u.isArray(O)){for(M=0,P=O.length;M<P;M++){K.addOption(O[M])}return}N=w(O[K.settings.valueField]);if(!N||K.options.hasOwnProperty(N)){return}K.userOptions[N]=true;K.options[N]=O;K.lastQuery=null;K.trigger("option_add",N,O)},addOptionGroup:function(L,K){this.optgroups[L]=K;this.trigger("optgroup_add",L,K)},updateOption:function(Q,O){var S=this;var R,K;var M,N,P,L;Q=w(Q);M=w(O[S.settings.valueField]);if(!S.options.hasOwnProperty(Q)){return}if(!M){throw new Error("Value must be set in option data")}if(M!==Q){delete S.options[Q];N=S.items.indexOf(Q);if(N!==-1){S.items.splice(N,1,M)}}S.options[M]=O;P=S.renderCache.item;L=S.renderCache.option;if(J(P)){delete P[Q];delete P[M]}if(J(L)){delete L[Q];delete L[M]}if(S.items.indexOf(M)!==-1){R=S.getItem(Q);K=u(S.render("item",O));if(R.hasClass("active")){K.addClass("active")}R.replaceWith(K)}if(S.isOpen){S.refreshOptions(false)}},removeOption:function(L){var K=this;L=w(L);delete K.userOptions[L];delete K.options[L];K.lastQuery=null;K.trigger("option_remove",L);K.removeItem(L)},clearOptions:function(){var K=this;K.loadedSearches={};K.userOptions={};K.options=K.sifter.items={};K.lastQuery=null;K.trigger("option_clear");K.clear()},getOption:function(K){return this.getElementWithValue(K,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(N,M){var K=this.$dropdown.find("[data-selectable]");var L=K.index(N)+M;return L>=0&&L<K.length?K.eq(L):u()},getElementWithValue:function(M,L){M=w(M);if(M){for(var K=0,N=L.length;K<N;K++){if(L[K].getAttribute("data-value")===M){return u(L[K])}}}return u()},getItem:function(K){return this.getElementWithValue(K,this.$control.children())},addItem:function(K){b(this,["change"],function(){var M,R;var L=this;var S=L.settings.mode;var P,Q,O,N;K=w(K);if(S==="single"){L.clear()}if(S==="multi"&&L.isFull()){return}if(L.items.indexOf(K)!==-1){return}if(!L.options.hasOwnProperty(K)){return}M=u(L.render("item",L.options[K]));L.items.splice(L.caretPos,0,K);L.insertAtCaret(M);L.refreshState();if(L.isSetup){O=L.$dropdown_content.find("[data-selectable]");R=L.getOption(K);N=L.getAdjacentOption(R,1).attr("data-value");L.refreshOptions(L.isFocused&&S!=="single");if(N){L.setActiveOption(L.getOption(N))}if(!O.length||(L.settings.maxItems!==null&&L.items.length>=L.settings.maxItems)){L.close()}else{L.positionDropdown()}L.updatePlaceholder();L.trigger("item_add",K,M);L.updateOriginalInput()}})},removeItem:function(O){var M=this;var L,N,K;L=(typeof O==="object")?O:M.getItem(O);O=w(L.attr("data-value"));N=M.items.indexOf(O);if(N!==-1){L.remove();if(L.hasClass("active")){K=M.$activeItems.indexOf(L[0]);M.$activeItems.splice(K,1)}M.items.splice(N,1);M.lastQuery=null;if(!M.settings.persist&&M.userOptions.hasOwnProperty(O)){M.removeOption(O)}if(N<M.caretPos){M.setCaret(M.caretPos-1)}M.refreshState();M.updatePlaceholder();M.updateOriginalInput();M.positionDropdown();M.trigger("item_remove",O)}},createItem:function(){var N=this;var M=u.trim(N.$control_input.val()||"");var P=N.caretPos;if(!M.length){return}N.lock();var K=(typeof N.settings.create==="function")?this.settings.create:function(Q){var R={};R[N.settings.labelField]=Q;R[N.settings.valueField]=Q;return R};var O=q(function(R){N.unlock();if(!R||typeof R!=="object"){return}var Q=w(R[N.settings.valueField]);if(!Q){return}N.setTextboxValue("");N.addOption(R);N.setCaret(P);N.addItem(Q);N.refreshOptions(N.settings.mode!=="single")});var L=K.apply(this,[M,O]);if(typeof L!=="undefined"){O(L)}},refreshItems:function(){this.lastQuery=null;if(this.isSetup){for(var K=0;K<this.items.length;K++){this.addItem(this.items)}}this.refreshState();this.updateOriginalInput()},refreshState:function(){var K=this;var L=K.isRequired&&!K.items.length;if(!L){K.isInvalid=false}K.$control_input.prop("required",L);K.refreshClasses()},refreshClasses:function(){var K=this;var L=K.isFull();var M=K.isLocked;this.$wrapper.toggleClass("rtl",K.rtl);this.$control.toggleClass("focus",K.isFocused).toggleClass("disabled",K.isDisabled).toggleClass("required",K.isRequired).toggleClass("invalid",K.isInvalid).toggleClass("locked",M).toggleClass("full",L).toggleClass("not-full",!L).toggleClass("input-active",K.isFocused&&!K.isInputHidden).toggleClass("dropdown-active",K.isOpen).toggleClass("has-options",!u.isEmptyObject(K.options)).toggleClass("has-items",K.items.length>0);this.$control_input.data("grow",!L&&!M)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var M,N,L,K=this;if(K.$input[0].tagName.toLowerCase()==="select"){L=[];for(M=0,N=K.items.length;M<N;M++){L.push('<option value="'+z(K.items[M])+'" selected="selected"></option>')}if(!L.length&&!this.$input.attr("multiple")){L.push('<option value="" selected="selected"></option>')}K.$input.html(L.join(""))}else{K.$input.val(K.getValue())}if(K.isSetup){K.trigger("change",K.$input.val())}},updatePlaceholder:function(){if(!this.settings.placeholder){return}var K=this.$control_input;if(this.items.length){K.removeAttr("placeholder")}else{K.attr("placeholder",this.settings.placeholder)}K.triggerHandler("update")},open:function(){var K=this;if(K.isLocked||K.isOpen||(K.settings.mode==="multi"&&K.isFull())){return}K.focus();K.isOpen=true;K.refreshState();K.$dropdown.css({visibility:"hidden",display:"block"});K.positionDropdown();K.$dropdown.css({visibility:"visible"});K.trigger("dropdown_open",this.$dropdown)},close:function(){var K=this;var L=K.isOpen;if(K.settings.mode==="single"&&this.items.length){K.hideInput()}K.isOpen=false;K.$dropdown.hide();K.setActiveOption(null);K.refreshState();if(L){K.trigger("dropdown_close",K.$dropdown)}},positionDropdown:function(){var K=this.$control;var L=this.settings.dropdownParent==="body"?K.offset():K.position();L.top+=K.outerHeight(true);this.$dropdown.css({width:K.outerWidth(),top:L.top,left:L.left})},clear:function(){var K=this;if(!K.items.length){return}K.$control.children(":not(input)").remove();K.items=[];K.setCaret(0);K.updatePlaceholder();K.updateOriginalInput();K.refreshState();K.showInput();K.trigger("clear")},insertAtCaret:function(K){var L=Math.min(this.caretPos,this.items.length);if(L===0){this.$control.prepend(K)}else{u(this.$control[0].childNodes[L]).before(K)}this.setCaret(L+1)},deleteSelection:function(N){var L,K,R,S,T,P,O,Q,M;var U=this;R=(N&&N.keyCode===m)?-1:1;S=k(U.$control_input[0]);if(U.$activeOption&&!U.settings.hideSelected){O=U.getAdjacentOption(U.$activeOption,-1).attr("data-value")}T=[];if(U.$activeItems.length){M=U.$control.children(".active:"+(R>0?"last":"first"));P=U.$control.children(":not(input)").index(M);if(R>0){P++}for(L=0,K=U.$activeItems.length;L<K;L++){T.push(u(U.$activeItems[L]).attr("data-value"))}if(N){N.preventDefault();N.stopPropagation()}}else{if((U.isFocused||U.settings.mode==="single")&&U.items.length){if(R<0&&S.start===0&&S.length===0){T.push(U.items[U.caretPos-1])}else{if(R>0&&S.start===U.$control_input.val().length){T.push(U.items[U.caretPos])}}}}if(!T.length||(typeof U.settings.onDelete==="function"&&U.settings.onDelete.apply(U,[T])===false)){return false}if(typeof P!=="undefined"){U.setCaret(P)}while(T.length){U.removeItem(T.pop())}U.showInput();U.refreshOptions(true);if(O){Q=U.getOption(O);if(Q.length){U.setActiveOption(Q)}}return true},advanceSelection:function(O,L){var M,P,Q,R,N,K;var S=this;if(O===0){return}if(S.rtl){O*=-1}M=O>0?"last":"first";P=k(S.$control_input[0]);if(S.isFocused&&!S.isInputHidden){R=S.$control_input.val().length;N=O<0?P.start===0&&P.length===0:P.start===R;if(N&&!R){S.advanceCaret(O,L)}}else{K=S.$control.children(".active:"+M);if(K.length){Q=S.$control.children(":not(input)").index(K);S.setActiveItem(null);S.setCaret(O>0?Q+1:Q)}}},advanceCaret:function(O,N){var K=this,M,L;if(O===0){return}M=O>0?"next":"prev";if(K.isShiftDown){L=K.$control_input[M]();if(L.length){K.hideInput();K.setActiveItem(L);N&&N.preventDefault()}}else{K.setCaret(K.caretPos+O)}},setCaret:function(N){var L=this;if(L.settings.mode==="single"){N=L.items.length}else{N=Math.max(0,Math.min(L.items.length,N))}var M,Q,O,K,P;K=L.$control.children(":not(input)");for(M=0,Q=K.length;M<Q;M++){P=u(K[M]).detach();if(M<N){L.$control_input.before(P)}else{L.$control.append(P)}}L.caretPos=N},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var K=this;K.$input.prop("disabled",true);K.isDisabled=true;K.lock()},enable:function(){var K=this;K.$input.prop("disabled",false);K.isDisabled=false;K.unlock()},destroy:function(){var K=this;var M=K.eventNS;var L=K.revertSettings;K.trigger("destroy");K.off();K.$wrapper.remove();K.$dropdown.remove();K.$input.html("").append(L.$children).attr({tabindex:L.tabindex}).show();u(window).off(M);u(document).off(M);u(document.body).off(M);delete K.$input[0].selectize},render:function(S,M){var Q,L,P;var N="";var K=false;var R=this;var O=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(S==="option"||S==="item"){Q=w(M[R.settings.valueField]);K=!!Q}if(K){if(!J(R.renderCache[S])){R.renderCache[S]={}}if(R.renderCache[S].hasOwnProperty(Q)){return R.renderCache[S][Q]}}N=R.settings.render[S].apply(this,[M,z]);if(S==="option"||S==="option_create"){N=N.replace(O,"<$1 data-selectable")}if(S==="optgroup"){L=M[R.settings.optgroupValueField]||"";N=N.replace(O,'<$1 data-group="'+z(L)+'"')}if(S==="option"||S==="item"){N=N.replace(O,'<$1 data-value="'+z(Q||"")+'"')}if(K){R.renderCache[S][Q]=N}return N}});d.count=0;d.defaults={plugins:[],delimiter:",",persist:true,diacritics:true,create:false,highlight:true,openOnFocus:true,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:false,preload:false,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}};u.fn.selectize=function(Q){var M=u.fn.selectize.defaults;var L=u.extend({},M,Q);var N=L.dataAttr;var T=L.labelField;var U=L.valueField;var S=L.optgroupField;var O=L.optgroupLabelField;var P=L.optgroupValueField;var K=function(ab,Z){var W,aa,V,X,Y=u.trim(ab.val()||"");if(!Y.length){return}V=Y.split(L.delimiter);for(W=0,aa=V.length;W<aa;W++){X={};X[T]=V[W];X[U]=V[W];Z.options[V[W]]=X}Z.items=V};var R=function(ac,aa){var ab,X,Y,ae,Z=0;var af=aa.options;var V=function(ag){var ah=N&&ag.attr(N);if(typeof ah==="string"&&ah.length){return JSON.parse(ah)}return null};var ad=function(aj,ai){var ah,ag;aj=u(aj);ah=aj.attr("value")||"";if(!ah.length){return}if(af.hasOwnProperty(ah)){if(ai){if(!af[ah].optgroup){af[ah].optgroup=ai}else{if(!u.isArray(af[ah].optgroup)){af[ah].optgroup=[af[ah].optgroup,ai]}else{af[ah].optgroup.push(ai)}}}return}ag=V(aj)||{};ag[T]=ag[T]||aj.text();ag[U]=ag[U]||ah;ag[S]=ag[S]||ai;ag.$order=++Z;af[ah]=ag;if(aj.is(":selected")){aa.items.push(ah)}};var W=function(ah){var aj,al,ak,ai,ag;ah=u(ah);ak=ah.attr("label");if(ak){ai=V(ah)||{};ai[O]=ak;ai[P]=ak;aa.optgroups[ak]=ai}ag=u("option",ah);for(aj=0,al=ag.length;aj<al;aj++){ad(ag[aj],ak)}};aa.maxItems=ac.attr("multiple")?null:1;ae=ac.children();for(ab=0,X=ae.length;ab<X;ab++){Y=ae[ab].tagName.toLowerCase();if(Y==="optgroup"){W(ae[ab])}else{if(Y==="option"){ad(ae[ab])}}}};return this.each(function(){if(this.selectize){return}var V;var Y=u(this);var X=this.tagName.toLowerCase();var W={placeholder:Y.children('option[value=""]').text()||Y.attr("placeholder"),options:{},optgroups:{},items:[]};if(X==="select"){R(Y,W)}else{K(Y,W)}V=new d(Y,u.extend(true,{},M,W,Q));Y.data("selectize",V);Y.addClass("selectized")})};u.fn.selectize.defaults=d.defaults;d.define("drag_drop",function(L){if(!u.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if(this.settings.mode!=="multi"){return}var K=this;K.lock=(function(){var M=K.lock;return function(){var N=K.$control.data("sortable");if(N){N.disable()}return M.apply(K,arguments)}})();K.unlock=(function(){var M=K.unlock;return function(){var N=K.$control.data("sortable");if(N){N.enable()}return M.apply(K,arguments)}})();K.setup=(function(){var M=K.setup;return function(){M.apply(this,arguments);var N=K.$control.sortable({items:"[data-value]",forcePlaceholderSize:true,disabled:K.isLocked,start:function(P,O){O.placeholder.css("width",O.helper.css("width"));N.css({overflow:"visible"})},stop:function(){N.css({overflow:"hidden"});var P=K.$activeItems?K.$activeItems.slice():null;var O=[];N.children("[data-value]").each(function(){O.push(u(this).attr("data-value"))});K.setValue(O);K.setActiveItem(P)}})}})()});d.define("dropdown_header",function(L){var K=this;L=u.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(M){return('<div class="'+M.headerClass+'"><div class="'+M.titleRowClass+'"><span class="'+M.labelClass+'">'+M.title+'</span><a href="javascript:void(0)" class="'+M.closeClass+'">&times;</a></div></div>')}},L);K.setup=(function(){var M=K.setup;return function(){M.apply(K,arguments);K.$dropdown_header=u(L.html(L));K.$dropdown.prepend(K.$dropdown_header)}})()});d.define("optgroup_columns",function(L){var K=this;L=u.extend({equalizeWidth:true,equalizeHeight:true},L);this.getAdjacentOption=function(Q,P){var N=Q.closest("[data-group]").find("[data-selectable]");var O=N.index(Q)+P;return O>=0&&O<N.length?N.eq(O):u()};this.onKeyDown=(function(){var N=K.onKeyDown;return function(S){var Q,R,O,P;if(this.isOpen&&(S.keyCode===o||S.keyCode===s)){K.ignoreHover=true;P=this.$activeOption.closest("[data-group]");Q=P.find("[data-selectable]").index(this.$activeOption);if(S.keyCode===o){P=P.prev("[data-group]")}else{P=P.next("[data-group]")}O=P.find("[data-selectable]");R=O.eq(Math.min(O.length-1,Q));if(R.length){this.setActiveOption(R)}return}return N.apply(this,arguments)}})();var M=function(){var O,T,N,P,S,R,Q;Q=u("[data-group]",K.$dropdown_content);T=Q.length;if(!T||!K.$dropdown_content.width()){return}if(L.equalizeHeight){N=0;for(O=0;O<T;O++){N=Math.max(N,Q.eq(O).height())}Q.css({height:N})}if(L.equalizeWidth){R=K.$dropdown_content.innerWidth();P=Math.round(R/T);Q.css({width:P});if(T>1){S=R-P*(T-1);Q.eq(T-1).css({width:S})}}};if(L.equalizeHeight||L.equalizeWidth){r.after(this,"positionDropdown",M);r.after(this,"refreshOptions",M)}});d.define("remove_button",function(M){if(this.settings.mode==="single"){return}M=u.extend({label:"&times;",title:"Remove",className:"remove",append:true},M);var L=this;var N='<a href="javascript:void(0)" class="'+M.className+'" tabindex="-1" title="'+z(M.title)+'">'+M.label+"</a>";var K=function(O,P){var Q=O.search(/(<\/[^>]+>\s*)$/);return O.substring(0,Q)+P+O.substring(Q)};this.setup=(function(){var O=L.setup;return function(){if(M.append){var P=L.settings.render.item;L.settings.render.item=function(Q){return K(P.apply(this,arguments),N)}}O.apply(this,arguments);this.$control.on("click","."+M.className,function(R){R.preventDefault();if(L.isLocked){return}var Q=u(R.target).parent();L.setActiveItem(Q);if(L.deleteSelection()){L.setCaret(L.items.length)}})}})()});d.define("restore_on_backspace",function(L){var K=this;L.text=L.text||function(M){return M[this.settings.labelField]};this.onKeyDown=(function(N){var M=K.onKeyDown;return function(Q){var O,P;if(Q.keyCode===m&&this.$control_input.val()===""&&!this.$activeItems.length){O=this.caretPos-1;if(O>=0&&O<this.items.length){P=this.options[this.items[O]];if(this.deleteSelection(Q)){this.setTextboxValue(L.text.apply(this,[P]));this.refreshOptions(true)}Q.preventDefault();return}}return M.apply(this,arguments)}})()});return d}));